<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kayıtlık - Twitter Yer İmleri</title>
  
  <!-- Tailwind CSS (Tasarım) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- FontAwesome (İkonlar) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- React ve ReactDOM (Mantık) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  
  <!-- Babel (JSX Çevirici) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Özel Scrollbar Tasarımı */
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    
    /* Yükleme Animasyonu Keyframe'i */
    @keyframes spin-slow {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes pulse-soft {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
</head>
<body class="bg-gray-50 text-slate-800 font-sans overflow-hidden">

  <!-- React'in içine render edileceği ana div. Yükleme animasyonu burada duruyor. -->
  <div id="root">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background-color: #f8fafc;">
      <div style="width: 50px; height: 50px; border: 4px solid #e2e8f0; border-top: 4px solid #0f172a; border-radius: 50%; animation: spin-slow 1s linear infinite;"></div>
      <h2 style="margin-top: 24px; color: #0f172a; font-size: 1.25rem; font-weight: bold; animation: pulse-soft 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;">Kayıtlık Yükleniyor...</h2>
      <p style="color: #64748b; font-size: 0.875rem; margin-top: 8px;">Arşivin hazırlanıyor, lütfen bekle</p>
    </div>
  </div>

  <!-- UYGULAMA KODLARI (Babel ile çalışacak) -->
  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    // --- OPTİMİZE EDİLMİŞ TWITTER EMBED BİLEŞENİ ---
    const TweetEmbed = ({ tweetId }) => {
      const [isVisible, setIsVisible] = useState(false);
      const containerRef = useRef(null);

      useEffect(() => {
        const observer = new IntersectionObserver(
          ([entry]) => {
            if (entry.isIntersecting) {
              setIsVisible(true);
              observer.disconnect();
            }
          },
          { rootMargin: '200px' }
        );

        if (containerRef.current) observer.observe(containerRef.current);
        return () => observer.disconnect();
      }, []);

      useEffect(() => {
        if (isVisible && window.twttr) {
          containerRef.current.innerHTML = ''; 
          window.twttr.widgets.createTweet(tweetId, containerRef.current, {
            theme: 'light',
            align: 'center',
            dnt: true 
          });
        }
      }, [isVisible, tweetId]);

      return (
        <div ref={containerRef} className="min-h-[200px] flex items-center justify-center bg-slate-50 rounded-xl border border-slate-100 mb-3">
          {!isVisible && <div className="text-slate-400 text-sm animate-pulse">Tweet yükleniyor...</div>}
        </div>
      );
    };

    // --- ANA UYGULAMA BİLEŞENİ ---
    function App() {
      const [bookmarks, setBookmarks] = useState([]);
      const [activeFolder, setActiveFolder] = useState('Tümü');
      const [searchQuery, setSearchQuery] = useState('');
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [isSidebarOpen, setIsSidebarOpen] = useState(false);

      const [newUrl, setNewUrl] = useState('');
      const [newFolder, setNewFolder] = useState('');
      const [newTags, setNewTags] = useState('');
      const [newDesc, setNewDesc] = useState('');

      useEffect(() => {
        const saved = localStorage.getItem('tweetBookmarks');
        if (saved) {
          try { setBookmarks(JSON.parse(saved)); } 
          catch (e) { console.error("Veri okuma hatası", e); }
        }

        if (!window.twttr) {
          const script = document.createElement("script");
          script.src = "https://platform.twitter.com/widgets.js";
          script.async = true;
          document.body.appendChild(script);
        }
      }, []);

      useEffect(() => {
        localStorage.setItem('tweetBookmarks', JSON.stringify(bookmarks));
      }, [bookmarks]);

      const handleExportJSON = () => {
        const dataStr = JSON.stringify(bookmarks, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `tweet-arsivim-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      const handleImportJSON = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const importedData = JSON.parse(e.target.result);
            if (Array.isArray(importedData)) {
              setBookmarks(importedData);
              alert('Arşiv başarıyla yüklendi!');
            } else {
              alert('Geçersiz dosya formatı.');
            }
          } catch (error) {
            alert('Dosya okunurken bir hata oluştu.');
          }
        };
        reader.readAsText(file);
        event.target.value = ''; 
      };

      const extractTweetId = (url) => {
        const match = url.match(/\/status\/(\d+)/);
        return match ? match[1] : null;
      };

      const handleAddBookmark = (e) => {
        e.preventDefault();
        const tweetId = extractTweetId(newUrl);

        if (!tweetId) {
          alert("Geçerli bir Twitter/X linki girdiğinizden emin olun.");
          return;
        }

        const newBookmark = {
          id: Date.now().toString(),
          tweetId: tweetId,
          url: newUrl,
          folder: newFolder.trim() || "Diğer",
          tags: newTags.split(',').map(t => t.trim().toLowerCase()).filter(Boolean),
          description: newDesc.trim(),
          date: new Date().toLocaleDateString('tr-TR', { day: 'numeric', month: 'short', year: 'numeric' })
        };

        setBookmarks([newBookmark, ...bookmarks]);
        setIsModalOpen(false);
        resetModal();
      };

      const handleDelete = (id) => {
        if(window.confirm("Bu yer imini silmek istediğinize emin misiniz?")) {
          setBookmarks(bookmarks.filter(b => b.id !== id));
        }
      };

      const resetModal = () => {
        setNewUrl('');
        setNewFolder('');
        setNewTags('');
        setNewDesc('');
      };

      const folders = useMemo(() => {
        const uniqueFolders = new Set(bookmarks.map(b => b.folder).filter(Boolean));
        return ['Tümü', ...Array.from(uniqueFolders)];
      }, [bookmarks]);

      const allTags = useMemo(() => {
        const tags = new Set();
        bookmarks.forEach(b => b.tags.forEach(t => tags.add(t)));
        return Array.from(tags);
      }, [bookmarks]);

      const filteredBookmarks = useMemo(() => {
        return bookmarks.filter(bookmark => {
          const matchesFolder = activeFolder === 'Tümü' || bookmark.folder === activeFolder;
          const searchLower = searchQuery.toLowerCase();
          const matchesSearch = 
            bookmark.tags.some(t => t.includes(searchLower)) ||
            (bookmark.description && bookmark.description.toLowerCase().includes(searchLower)) ||
            bookmark.folder.toLowerCase().includes(searchLower);
          
          return matchesFolder && matchesSearch;
        });
      }, [bookmarks, activeFolder, searchQuery]);

      return (
        <div className="flex h-screen w-full bg-gray-50 text-slate-800 font-sans overflow-hidden">
          
          {isSidebarOpen && (
            <div className="fixed inset-0 bg-black/20 z-20 lg:hidden" onClick={() => setIsSidebarOpen(false)} />
          )}

          <aside className={`
            fixed inset-y-0 left-0 z-30 w-64 bg-white border-r border-gray-100 flex flex-col transition-transform duration-300 ease-in-out
            ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}
            lg:static lg:flex-shrink-0
          `}>
            <div className="p-6 flex items-center gap-3 border-b border-gray-50">
              <div className="w-8 h-8 bg-black rounded-lg flex items-center justify-center shadow-md">
                <i className="fa-solid fa-bookmark text-white text-sm"></i>
              </div>
              <h1 className="text-xl font-bold tracking-tight text-slate-900">Kayıtlık</h1>
            </div>

            <div className="flex-1 overflow-y-auto py-6 px-4 space-y-8 custom-scrollbar">
              <div>
                <h2 className="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3 px-2">Klasörler</h2>
                <ul className="space-y-1">
                  {folders.map(folder => (
                    <li key={folder}>
                      <button
                        onClick={() => { setActiveFolder(folder); setIsSidebarOpen(false); }}
                        className={`w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm transition-all duration-200 ${
                          activeFolder === folder 
                            ? 'bg-black text-white font-medium shadow-sm' 
                            : 'text-slate-500 hover:bg-slate-100 hover:text-slate-900'
                        }`}
                      >
                        <i className={`fa-solid fa-folder ${activeFolder === folder ? 'text-white' : 'text-slate-400'}`}></i>
                        <span className="truncate">{folder}</span>
                        <span className={`ml-auto text-xs ${activeFolder === folder ? 'text-slate-300' : 'text-slate-400'}`}>
                          {folder === 'Tümü' ? bookmarks.length : bookmarks.filter(b => b.folder === folder).length}
                        </span>
                      </button>
                    </li>
                  ))}
                </ul>
              </div>

              {allTags.length > 0 && (
                <div>
                  <h2 className="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3 px-2">Etiketler</h2>
                  <div className="flex flex-wrap gap-2 px-2">
                    {allTags.slice(0, 15).map(tag => (
                      <button 
                        key={tag}
                        onClick={() => setSearchQuery(tag)}
                        className="px-2.5 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-lg text-xs font-medium transition-colors flex items-center gap-1.5"
                      >
                        <i className="fa-solid fa-hashtag text-[10px] text-slate-400"></i>
                        {tag}
                      </button>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </aside>

          <main className="flex-1 flex flex-col h-screen overflow-hidden relative">
            <header className="h-20 bg-white/80 backdrop-blur-md border-b border-gray-100 flex items-center justify-between px-4 sm:px-8 z-10 shrink-0">
              <div className="flex items-center gap-4">
                <button className="lg:hidden p-2 -ml-2 text-slate-500 hover:bg-slate-100 rounded-lg" onClick={() => setIsSidebarOpen(true)}>
                  <i className="fa-solid fa-bars text-lg"></i>
                </button>
                <div>
                  <h2 className="text-xl font-bold text-slate-900 capitalize hidden sm:block">{activeFolder}</h2>
                  <p className="text-sm text-slate-500 hidden sm:block">{filteredBookmarks.length} yer imi listeleniyor</p>
                </div>
              </div>

              <div className="flex items-center gap-3 sm:gap-4">
                <div className="relative hidden md:block">
                  <i className="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                  <input 
                    type="text" 
                    placeholder="Notlarda ve etiketlerde ara..." 
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="pl-9 pr-4 py-2.5 w-64 bg-slate-100 border-transparent rounded-full text-sm focus:bg-white focus:border-slate-300 focus:ring-2 focus:ring-slate-100 outline-none transition-all"
                  />
                </div>
                
                <div className="flex bg-slate-100 rounded-full p-1">
                  <button onClick={handleExportJSON} title="Yedeği İndir" className="p-2 w-8 h-8 flex items-center justify-center text-slate-500 hover:text-slate-900 hover:bg-white rounded-full transition-all">
                    <i className="fa-solid fa-download text-sm"></i>
                  </button>
                  <label title="Yedeği Yükle" className="p-2 w-8 h-8 flex items-center justify-center text-slate-500 hover:text-slate-900 hover:bg-white rounded-full transition-all cursor-pointer">
                    <i className="fa-solid fa-upload text-sm"></i>
                    <input type="file" accept=".json" className="hidden" onChange={handleImportJSON} />
                  </label>
                </div>

                <button 
                  onClick={() => setIsModalOpen(true)}
                  className="flex items-center gap-2 bg-black hover:bg-slate-800 text-white px-5 py-2.5 rounded-full text-sm font-medium transition-all shadow-md hover:shadow-lg active:scale-95"
                >
                  <i className="fa-solid fa-plus text-sm"></i>
                  <span className="hidden sm:inline">Yeni Ekle</span>
                </button>
              </div>
            </header>

            <div className="flex-1 overflow-y-auto p-4 sm:p-8 custom-scrollbar bg-slate-50/50">
              {filteredBookmarks.length === 0 ? (
                <div className="flex flex-col items-center justify-center h-full text-center max-w-sm mx-auto">
                  <div className="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-6 shadow-inner">
                    <i className="fa-solid fa-bookmark text-3xl text-slate-300"></i>
                  </div>
                  <h3 className="text-xl font-bold text-slate-800 mb-2">Henüz tweet yok</h3>
                  <p className="text-slate-500 text-sm leading-relaxed mb-8">
                    Sağ üstteki "Yeni Ekle" butonuna tıklayarak ilk tweetini kaydet veya önceden indirdiğin yedeğini yükle.
                  </p>
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start">
                  {filteredBookmarks.map((bookmark) => (
                    <div key={bookmark.id} className="bg-white rounded-2xl p-5 border border-slate-100 shadow-sm hover:shadow-md transition-shadow group">
                      
                      <div className="mb-4">
                        {bookmark.description && (
                          <p className="text-sm font-medium text-slate-800 mb-3 leading-relaxed">
                            {bookmark.description}
                          </p>
                        )}
                        <div className="flex flex-wrap items-center gap-2">
                          <span className="inline-flex items-center gap-1.5 px-2.5 py-1 bg-slate-100 text-slate-600 rounded-md text-[10px] font-bold uppercase tracking-wide">
                            <i className="fa-solid fa-folder text-[10px]"></i>
                            {bookmark.folder}
                          </span>
                          {bookmark.tags.map(tag => (
                            <span key={tag} className="text-xs text-blue-500 font-medium bg-blue-50 px-2 py-0.5 rounded-md">
                              #{tag}
                            </span>
                          ))}
                        </div>
                      </div>

                      <div className="relative">
                        <TweetEmbed tweetId={bookmark.tweetId} />
                        
                        <div className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1">
                          <a href={bookmark.url} target="_blank" rel="noreferrer" className="w-7 h-7 flex items-center justify-center bg-white shadow-sm border border-slate-100 rounded-lg text-slate-400 hover:text-blue-500 transition-colors">
                            <i className="fa-solid fa-arrow-up-right-from-square text-[12px]"></i>
                          </a>
                          <button onClick={() => handleDelete(bookmark.id)} className="w-7 h-7 flex items-center justify-center bg-white shadow-sm border border-slate-100 rounded-lg text-slate-400 hover:text-red-500 transition-colors">
                            <i className="fa-solid fa-trash-can text-[12px]"></i>
                          </button>
                        </div>
                      </div>

                      <div className="mt-2 text-right">
                        <span className="text-[10px] text-slate-400 font-medium">{bookmark.date}</span>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </main>

          {isModalOpen && (
            <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
              <div className="bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl animate-in fade-in zoom-in-95 duration-200">
                <div className="flex justify-between items-center p-6 border-b border-slate-100 bg-slate-50/50">
                  <h3 className="text-lg font-bold text-slate-900">Yeni Tweet Kaydet</h3>
                  <button onClick={() => setIsModalOpen(false)} className="w-8 h-8 flex items-center justify-center text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded-full transition-colors">
                    <i className="fa-solid fa-xmark text-lg"></i>
                  </button>
                </div>
                
                <form onSubmit={handleAddBookmark} className="p-6 space-y-5">
                  <div>
                    <label className="block text-sm font-semibold text-slate-700 mb-1.5">Twitter / X Linki</label>
                    <input 
                      type="url" required
                      placeholder="https://x.com/kullanici/status/123..."
                      value={newUrl}
                      onChange={(e) => setNewUrl(e.target.value)}
                      className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black focus:bg-white transition-all"
                    />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-slate-700 mb-1.5">Klasör</label>
                      <input 
                        type="text" 
                        placeholder="Örn: Tasarım"
                        value={newFolder}
                        onChange={(e) => setNewFolder(e.target.value)}
                        list="folder-options"
                        className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black focus:bg-white transition-all"
                      />
                      <datalist id="folder-options">
                        {folders.filter(f => f !== 'Tümü').map(f => <option key={f} value={f} />)}
                      </datalist>
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-slate-700 mb-1.5">Etiketler</label>
                      <input 
                        type="text" 
                        placeholder="virgülle ayırın"
                        value={newTags}
                        onChange={(e) => setNewTags(e.target.value)}
                        className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black focus:bg-white transition-all"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-slate-700 mb-1.5">Senin Notun</label>
                    <textarea 
                      placeholder="Bu tweeti neden kaydettiniz?"
                      rows="3"
                      value={newDesc}
                      onChange={(e) => setNewDesc(e.target.value)}
                      className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black focus:bg-white transition-all resize-none"
                    ></textarea>
                  </div>

                  <div className="pt-2">
                    <button type="submit" className="w-full bg-black hover:bg-slate-800 text-white font-medium py-3.5 rounded-xl transition-all shadow-md active:scale-[0.98] flex items-center justify-center gap-2">
                      <i className="fa-solid fa-bookmark text-sm"></i>
                      Koleksiyona Kaydet
                    </button>
                  </div>
                </form>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Uygulamayı ekrana bas
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>